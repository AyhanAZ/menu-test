<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js"></script>
<script>
    // Firebase configuration
    const firebaseConfig = {
        apiKey: "your-api-key",
        authDomain: "your-auth-domain",
        databaseURL: "your-database-url",
        projectId: "your-project-id",
        storageBucket: "your-storage-bucket",
        messagingSenderId: "your-messaging-sender-id",
        appId: "your-app-id"
    };


    // Initialize Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
</script>

    <title>Company Name</title>
    <style>
        body {
            font-family: Tahoma, sans-serif;
            direction: rtl;
            margin: 0;
            padding: 0;
        }

        .saved-files-tab {
    margin: 20px auto;
    padding: 10px;
    border: 2px solid #73a4ff;
    border-radius: 10px;
    background-color: #f9f9f9;
    text-align: center;
    width: 95%;
}


.saved-file-entry {
    margin: 10px 0;
    padding: 10px;
    border-bottom: 1px solid #ccc;
}


.saved-file-entry button {
    margin: 5px;
    padding: 5px 10px;
    background-color: #73a4ff;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}


.saved-file-entry button:hover {
    background-color: #315f80;
}



        header, footer {
            background-color: #ffffff;
            color: #73a4ff;
            text-align: left;
            padding: 8px 0;
            margin-left: 5%;
            position: relative;
        }

        header {
            font-size: 10px;
            font-weight: bold;
        }

        header h2 {
            text-align: right;
            margin-right: 20px;
            font-size: 20px;
            font-weight: bold;
            
        }

        
        header img {
            position: absolute;
            top: -115px;
            right: -180px;
            width: 68%;
            margin: 0%;
            padding: 0%;
            height: auto;
            background-color: transparent;
            object-fit: contain;
        }

        footer {
            position: relative;
            text-align: center;
            font-size: 18px;
            min-height: 100%;
            min-width: 100%;
        }

        .separator-line {
            border: none;
            border-top: 3px solid #73a4ff;
            margin: 5px auto;
            width: 95%;
        }
        
                .agent-row {
            border: none;
            border-top: 3px solid #73a4ff;
            margin: 5px auto;
            width: 95%;
        }

        .footer-line-sep {
            border: none;
            border-top: 5px solid #73a4ff;
            margin: 10px auto;
            width: 95%;
        }

        .resizable-table {
            width: 95%;
            border-collapse: collapse;
            border: 1px solid #000;
            margin: 20px auto;
            table-layout: fixed;
        }

        th, td {
            text-align: right;
            border: 1px solid #000;
            word-wrap: break-word;
            white-space: normal;
            overflow: hidden;
            padding: 10px;
            position: relative;
            font-size: 14px;
            cursor: pointer;
        }

        th {
            background-color: #f0f0f0;
            font-weight: bold;
        }

        tr:nth-child(even) {
            background-color: #dadada;
        }

        .editor-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #f9f9f9;
            border: 2px solid #73a4ff;
            border-radius: 10px;
            padding: 20px;
            z-index: 1000;
            display: none;
            width: 400px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .editor-popup label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            color: #333;
        }

        .editor-popup input[type="text"], .editor-popup select {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
        }

        .editor-popup input[type="range"] {
            width: 100%;
            margin-bottom: 10px;
        }

        .font-size-display {
            text-align: center;
            margin-top: 5px;
            font-size: 14px;
            font-weight: bold;
            color: #555;
        }

        .editor-popup button {
            margin-top: 10px;
            padding: 10px;
            border: none;
            background-color: #73a4ff;
            color: white;
            cursor: pointer;
            border-radius: 5px;
            width: 48%;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .editor-popup button:hover {
            background-color: #315f80;
        }

        .editor-popup .reset-button {
            background-color: #e63946;
        }

        .editor-popup .reset-button:hover {
            background-color: #a0212f;
        }

        #calculate-button, #calculate-total {
            background-color: #73a4ff;
            color: white;
            font-size: 16px;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 20px auto;
            display: block;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease-in-out;
        }

        #calculate-button:hover, #calculate-total:hover {
            background-color: #315f80;
            transform: scale(1.05);
            box-shadow: 3px 3px 8px rgba(0, 0, 0, 0.5);
        }

        #calculate-button:active, #calculate-total:active {
            transform: scale(1);
            box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
        }
        @media print { 
           #calculate-total {
            display: none;
           }
        }

        .total-section {
            width: 60%;
            margin: 20px auto;
            border: 2px solid #73a4ff;
            border-radius: 10px;
            text-align: center;
            background-color: #f9f9f9;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .total-header {
            font-size: 20px;
            font-weight: bold;
            background-color: #73a4ff;
            color: white;
            padding: 10px;
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
        }

        .total-body {
            display: flex;
            justify-content: space-around;
            padding: 20px;
        }

        .total-column input {
            background-color: #f1f1f1;
            width: 90%;
            padding: 10px;
            margin-top: 2%;
            text-align: center;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
        }
        #resizing-tool {
    background-color: #f9f9f9;
    border: 2px solid #73a4ff;
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    max-width: 600px;
    text-align: center;
}

#resizing-tool h3 {
    color: #73a4ff;
    margin-bottom: 20px;
}

.slider-container {
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    justify-content: space-between;
}


        @media print { 
           #add-row-button {
            display: none;
           }
        }

        @media print { 
           #remove-row-button {
            display: none;
           }
        }


#draggable-logo {
    position: fixed; /* Allows the image to be moved anywhere */
    top: 20px; /* Initial position */
    right: 20px; /* Initial position */
    z-index: 9999;
    pointer-events: none;
    cursor: move; /* Change cursor to indicate drag functionality */
    width: 65%; /* Set logo size */
    height: auto; /* Maintain aspect ratio */
}

.slider-container label {
    width: 20%;
    text-align: left;
    font-weight: bold;
}

.slider-container input[type="range"] {
    width: 60%;
}

.slider-value {
    width: 20%;
    text-align: right;
}

#reset-columns {
    background-color: #73a4ff;
    color: white;
    font-size: 14px;
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3);
    transition: all 0.3s ease-in-out;
}

#reset-columns:hover {
    background-color: #73a4ff;
    transform: scale(1.05);
    box-shadow: 3px 3px 8px rgba(0, 0, 0, 0.5);
}

/* Hide Resizing Tool During Print */
@media print {
    #resize-columns-button{
        display: none !important;
    }
}

.resizable-table th:first-child,
.resizable-table td:first-child {
    width: 50px; /* Adjust as needed */
    max-width: 70px; /* Optional: to ensure no extreme resizing */
    text-align: center; /* Optional: for better alignment */
}

@media print {
    #add-column-button,
    #remove-column-button {
        display: none;
    }
}

/* Parent container for centering */
.center-container {
    display: flex; /* Enables flexbox for centering */
    justify-content: center; /* Centers horizontally */
    margin: 10px 0; /* Adds spacing between header and table */
}

/* Oval styling */
.editable-oval {
    display: inline-block; /* Keep it dynamically sized */
    text-align: center;
    font-weight: bold;/* Centers text inside the oval */
    padding: 10px 20px; /* Inner spacing for oval shape */
    border: 2px solid #73a4ff; /* Border color */
    border-radius: 50px; /* Creates the oval shape */
    font-size: 16px; /* Text size */
    color: #000; /* Text color */
    background-color: transparent; /* Transparent background */
    outline: none; /* Removes focus outline */
    cursor: text; /* Shows text-editing cursor */
}



.popup-container {
    display: none; /* Initially hidden */
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5); /* Dim background */
    z-index: 9999; /* On top of everything */
}


.popup-content {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: white;
    padding: 20px;
    border-radius: 10px;
    text-align: center;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    width: 300px;
}


.popup-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    justify-content: center;
    margin-bottom: 20px;
}


.agent-button {
    background-color: #73a4ff;
    color: white;
    border: none;
    padding: 10px 15px;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s ease;
}


.agent-button:hover {
    background-color: #315f80;
}


#close-popup {
    background-color: #e63946;
    color: white;
    border: none;
    padding: 10px 15px;
    border-radius: 5px;
    cursor: pointer;
}


#close-popup:hover {
    background-color: #a0212f;
}

/* Tabs Container */
.tabs-container {
    display: flex;
    align-items: center;
    margin: 20px auto;
    padding: 5px;
    width: 95%;
    border-bottom: 2px solid #73a4ff;
}


.tab-buttons {
    flex-grow: 1;
    display: flex;
    gap: 10px;
    overflow-x: auto;
}


.tab-button {
    padding: 8px 12px;
    border: none;
    border-radius: 5px;
    background-color: #73a4ff;
    color: white;
    cursor: pointer;
    transition: background-color 0.3s ease;
}


.tab-button.active {
    background-color: #315f80;
    font-weight: bold;
}


.tab-button:hover {
    background-color: #315f80;
}


.new-tab-button {
    padding: 5px 10px;
    border: none;
    border-radius: 5px;
    background-color: #e63946;
    color: white;
    cursor: pointer;
    font-size: 20px;
    line-height: 20px;
    height: 35px;
}


.new-tab-button:hover {
    background-color: #a0212f;
}


@media print {
    .new-tab-button, .tab-buttons {
        display: none;
    }
}


#table-container {
    margin: 20px auto;
    width: 95%;
}

/* Floating Button */
.floating-button {
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background-color: #73a4ff;
    color: white;
    border: none;
    box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
    font-size: 24px;
    cursor: pointer;
    transition: all 0.3s ease-in-out;
    z-index: 999;
}


.floating-button:hover {
    background-color: #315f80;
    transform: scale(1.1);
}


/* Popup Styles */
.popup-container {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5); /* Dim background */
    z-index: 9999;
}


.popup-content {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: white;
    padding: 20px;
    border-radius: 10px;
    text-align: center;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    width: 400px;
}


.close-button {
    background-color: #e63946;
    color: white;
    border: none;
    padding: 10px 15px;
    border-radius: 5px;
    cursor: pointer;
    margin-top: 10px;
}


.close-button:hover {
    background-color: #a0212f;
}


/* Saved File Entry */
.saved-file-entry {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin: 10px 0;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
    background-color: #f9f9f9;
}


.saved-file-entry button {
    padding: 5px 10px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s ease;
}


.saved-file-entry button.load-button {
    background-color: #73a4ff;
    color: white;
}


.saved-file-entry button.load-button:hover {
    background-color: #315f80;
}


.saved-file-entry button.delete-button {
    background-color: #e63946;
    color: white;
}


.saved-file-entry button.delete-button:hover {
    background-color: #a0212f;
}


/* Hide During Print */
@media print {
    .floating-button, 
    .popup-container {
        display: none !important;
    }
}



    </style>
</head>
<body>
    <header>
       
        <h1>AL SAKHI GENERAL TRADING CO.LTD</h1>
        <h2>شركة السخي للتجارة العامة المحدودة </h2>
    </header>
    <hr class="separator-line">
    <div class="center-container">
        <div class="editable-oval" id="agent-selector">Select Agent</div>
    </div>
    
    <!-- Save Files Button -->
<button id="show-saved-files" class="floating-button" title="Saved Files">
    💾
</button>




<!-- Saved Files Popup -->
<div id="saved-files-popup" class="popup-container">
    <div class="popup-content">
        <h3>Saved Files</h3>
        <div id="saved-files-list"></div>
        <button id="close-saved-files" class="close-button">Close</button>
    </div>
</div>

    
    <!-- Popup -->
    <div id="agent-popup" class="popup-container">
        <div class="popup-content">
            <h3>Select an Agent</h3>
            <div class="popup-buttons">
                <!-- 12 Buttons for Agents -->
                <button class="agent-button" data-agent="خبيب - دهوك">خبيب - دهوك</button>
                <button class="agent-button" data-agent="نژيار - زاخو">نژيار - زاخو</button>
                <button class="agent-button" data-agent="يوسف - عقرة">يوسف - عقرة</button>
                <button class="agent-button" data-agent="ناصح - أربيل">ناصح - أربيل</button>
                <button class="agent-button" data-agent="علي - أربيل">علي - أربيل</button>
                <button class="agent-button" data-agent="سردار - أربيل">سردار - أربيل</button>
                <button class="agent-button" data-agent="ريبوار - أربيل">ريبوار - أربيل</button>
                <button class="agent-button" data-agent="مؤيد - كركوك">مؤيد - كركوك</button>
                <button class="agent-button" data-agent="نورس - رانية">نورس - رانية</button>
              <button class="agent-button" data-agent="فرياد - كلار" >فرياد - كلار</button>
              <button class="agent-button" data-agent="شاهو - سليمانية" >Agent 11</button>
              <button class="agent-button" data-agent="سربست - كلك" >سربست - كلك</button>
            </div>
            <button id="close-popup">Close</button>
        </div>
    </div>
    
    <!-- Main Table -->
    <table class="resizable-table">
        <thead>
            <tr>
                <th>#</th>
                <th>مدين</th>
                <th>دائن</th>
                <th>نقل</th>
                <th>التاريخ</th>
                <th>البيان</th>
                <th>الرصيد</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
        </tbody>
    </table>

    <!-- Total Row Section -->
     <!-- Resize Columns Button -->
<button id="resize-columns-button" style="margin: 20px auto; display: block;">Resize Columns</button>

<!-- Add and Remove Columns Buttons -->
<div style="display: flex; justify-content: center; gap: 10px; margin-top: 10px;">
    <button id="add-column-button">Add Column</button>
    <button id="remove-column-button">Remove Column</button>
    <button id="add-row-button">Add Row</button>
<button id="remove-row-button">Remove Row</button>
<button id="save-table-button">Save Table</button>


</div>


<!-- Resizing Tool Section -->
<div id="resizing-tool" style="display: none; margin: 20px auto; text-align: center;">
    <h3>Resize Columns</h3>
    <div id="sliders-container"></div>
    <button id="reset-columns">Reset Columns</button>
</div>

    <div class="total-section">
        <div class="total-header">الحساب الكلي</div>
        <div class="total-body">
            <div class="total-column">
                <label for="total-debit">إجمالي المدين:</label>
                <input type="text" id="total-debit" placeholder="0.00" readonly>
            </div>
            <div class="total-column">
                <label for="total-credit">إجمالي الدائن:</label>
                <input type="text" id="total-credit" placeholder="0.00" readonly>
            </div>
            <div class="total-column">
                <label for="total-balance">الرصيد النهائي:</label>
                <input type="text" id="total-balance" placeholder="0.00" readonly>
            </div>
        </div>
        <button id="calculate-total">حساب</button>
    </div>


    <!-- Popup Editor -->
    <div class="editor-popup">
        <label for="cell-text">Edit Text:</label>
        <input type="text" id="cell-text" placeholder="Type your text here">

        <label for="font-style">Font Style:</label>
        <select id="font-style">
            <option value="normal">Normal</option>
            <option value="italic">Italic</option>
            <option value="bold">Bold</option>
        </select>

        <label for="font-slider">Font Size:</label>
        <input type="range" id="font-slider" min="10" max="30" value="14">
        <div class="font-size-display" id="font-size-display">14px</div>

        <div id="live-preview">Live Preview: <span id="preview-text"></span></div>

        <div style="display: flex; justify-content: space-between;">
            <button id="save-edit">Save</button>
            <button id="cancel-edit">Cancel</button>
            <button id="reset-edit" class="reset-button">Reset</button>
        </div>
    </div>

    <script>
        let activeElement;
        let originalText = "";
        let originalFontSize = "";
        let originalFontStyle = "";
// Double-click to open the popup
document.querySelectorAll("td, th").forEach(cell => {
    cell.addEventListener("dblclick", () => {
        activeElement = cell;
        document.querySelector(".editor-popup").style.display = "block";

        // Store original values
        originalText = cell.textContent;
        originalFontSize = parseInt(window.getComputedStyle(cell).fontSize, 10); // Ensure numeric font size
        originalFontStyle = window.getComputedStyle(cell).fontStyle;

        // Populate popup fields
        document.getElementById("cell-text").value = originalText;
        document.getElementById("font-slider").value = originalFontSize;
        document.getElementById("font-style").value = originalFontStyle;
        document.getElementById("font-size-display").textContent = `${originalFontSize}px`;

        // Populate preview
        updateLivePreview();
    });
});

// Update preview text dynamically and synchronize slider
document.getElementById("cell-text").addEventListener("input", updateLivePreview);
document.getElementById("font-slider").addEventListener("input", (e) => {
    const fontSize = e.target.value;
    document.getElementById("font-size-display").textContent = `${fontSize}px`;

    // Apply the font size to the active element in real-time
    if (activeElement) {
        activeElement.style.fontSize = `${fontSize}px`;
    }
});
document.getElementById("font-style").addEventListener("change", updateLivePreview);

// Synchronize font size display on popup close or save
function updateLivePreview() {
    const preview = document.getElementById("preview-text");
    const fontSize = document.getElementById("font-slider").value;
    preview.textContent = document.getElementById("cell-text").value;
    preview.style.fontSize = `${fontSize}px`;
    preview.style.fontStyle = document.getElementById("font-style").value;

    // Update slider value display dynamically
    document.getElementById("font-size-display").textContent = `${fontSize}px`;
}

// Save changes
document.getElementById("save-edit").addEventListener("click", () => {
    const newText = document.getElementById("cell-text").value;
    const newFontSize = document.getElementById("font-slider").value + "px";
    const newFontStyle = document.getElementById("font-style").value;

    // Apply changes to the active element
    if (activeElement) {
        activeElement.textContent = newText;
        activeElement.style.fontSize = newFontSize;
        activeElement.style.fontStyle = newFontStyle;
    }

    closePopup();
});

// Cancel editing
document.getElementById("cancel-edit").addEventListener("click", closePopup);

// Reset changes
document.getElementById("reset-edit").addEventListener("click", () => {
    document.getElementById("cell-text").value = originalText;
    document.getElementById("font-slider").value = originalFontSize;
    document.getElementById("font-style").value = originalFontStyle;
    document.getElementById("font-size-display").textContent = `${originalFontSize}px`;
    updateLivePreview();
});

function closePopup() {
    document.querySelector(".editor-popup").style.display = "none";
}

        // Cancel editing
        document.getElementById("cancel-edit").addEventListener("click", closePopup);

        // Reset changes
        document.getElementById("reset-edit").addEventListener("click", () => {
            document.getElementById("cell-text").value = originalText;
            document.getElementById("font-slider").value = originalFontSize;
            document.getElementById("font-style").value = originalFontStyle;
            document.getElementById("font-size-display").textContent = originalFontSize + "px";
            updateLivePreview();
        });

                function closePopup() {
            document.querySelector(".editor-popup").style.display = "none";
        }

        // Handle Resize Columns Button
document.getElementById("resize-columns-button").addEventListener("click", () => {
    const resizingTool = document.getElementById("resizing-tool");
    if (resizingTool.style.display === "none") {
        generateSliders();
        resizingTool.style.display = "block";
    } else {
        resizingTool.style.display = "none";
    }
});

function applyPopupToNewCells() {
    // Reapply the double-click event listener to all table cells
    document.querySelectorAll("td, th").forEach(cell => {
        cell.removeEventListener("dblclick", handleCellDoubleClick); // Avoid duplicate listeners
        cell.addEventListener("dblclick", handleCellDoubleClick);
    });
}


    
// Generate Sliders for Each Column
// Generate Sliders for Each Column
function generateSliders() {
    const table = document.querySelector(".resizable-table");
    const slidersContainer = document.getElementById("sliders-container");
    slidersContainer.innerHTML = ""; // Clear previous sliders

    const columns = table.querySelectorAll("th");
    columns.forEach((column, index) => {
        // Create slider container
        const sliderContainer = document.createElement("div");
        sliderContainer.className = "slider-container";

        // Column label
        const label = document.createElement("label");
        label.textContent = `Column ${index + 1}`;

        // Slider
        const slider = document.createElement("input");
        slider.type = "range";
        slider.min = index === 0 ? "30" : "50"; // Smaller minimum for the first column
        slider.max = index === 0 ? "200" : "500"; // Smaller maximum for the first column
        slider.value = column.offsetWidth; // Set current width as default

        // Slider value display
        const valueDisplay = document.createElement("span");
        valueDisplay.className = "slider-value";
        valueDisplay.textContent = `${column.offsetWidth}px`;

        // Update column width on slider input
        slider.addEventListener("input", () => {
            column.style.width = `${slider.value}px`;
            table.querySelectorAll(`td:nth-child(${index + 1})`).forEach(cell => {
                cell.style.width = `${slider.value}px`;
            });
            valueDisplay.textContent = `${slider.value}px`;
        });

        // Append elements to slider container
        sliderContainer.appendChild(label);
        sliderContainer.appendChild(slider);
        sliderContainer.appendChild(valueDisplay);

        // Append slider container to sliders container
        slidersContainer.appendChild(sliderContainer);
    });
}

function handleCellDoubleClick() {
    activeElement = this; // Reference the clicked element
    document.querySelector(".editor-popup").style.display = "block";

    // Store original values
    originalText = this.textContent;
    originalFontSize = parseInt(window.getComputedStyle(this).fontSize, 10); // Ensure numeric font size
    originalFontStyle = window.getComputedStyle(this).fontStyle;

    // Populate popup fields
    document.getElementById("cell-text").value = originalText;
    document.getElementById("font-slider").value = originalFontSize;
    document.getElementById("font-style").value = originalFontStyle;
    document.getElementById("font-size-display").textContent = `${originalFontSize}px`;

    updateLivePreview();
}


function applyDynamicFeatures() {
    document.querySelectorAll("td, th").forEach(cell => {
        cell.removeEventListener("dblclick", handleCellDoubleClick); // Avoid duplicates
        cell.addEventListener("dblclick", handleCellDoubleClick); // Reapply popup listener
    });
}

// Get references to elements
const agentSelector = document.getElementById("agent-selector");
const popupContainer = document.getElementById("agent-popup");
const closePopupButton = document.getElementById("close-popup");
const agentButtons = document.querySelectorAll(".agent-button");


// Show the popup when clicking the oval text
agentSelector.addEventListener("click", () => {
    popupContainer.style.display = "block";
});


// Close the popup when clicking the "Close" button
closePopupButton.addEventListener("click", () => {
    popupContainer.style.display = "none";
});


// Close the popup when clicking outside of the popup content
popupContainer.addEventListener("click", (e) => {
    if (e.target === popupContainer) {
        popupContainer.style.display = "none";
    }
});


// Update the oval text and close popup when an agent is selected
agentButtons.forEach(button => {
    button.addEventListener("click", () => {
        const selectedAgent = button.getAttribute("data-agent");
        agentSelector.textContent = selectedAgent; // Update the oval text
        popupContainer.style.display = "none"; // Hide the popup
    });
});


// Add a new column to the table
document.getElementById("add-column-button").addEventListener("click", () => {
    const table = document.querySelector(".resizable-table");
    const rows = table.querySelectorAll("tr");

    // Add a new header for the column
    if (rows[0]) {
        const headerCell = document.createElement("th");
        headerCell.textContent = `New Column ${rows[0].children.length + 1}`;
        rows[0].appendChild(headerCell);
    }

    // Add new cells to each row
    rows.forEach((row, rowIndex) => {
        if (rowIndex === 0) return; // Skip header row
        const newCell = document.createElement("td");
        newCell.contentEditable = true; // Make it editable
        newCell.textContent = "New Value"; // Default content
        row.appendChild(newCell);
    });

    // Reapply popup functionality for all cells
    applyPopupToNewCells();
});

// Remove the last column from the table
document.getElementById("remove-column-button").addEventListener("click", () => {
    const table = document.querySelector(".resizable-table");
    const rows = table.querySelectorAll("tr");

    if (rows[0] && rows[0].children.length > 1) {
        rows.forEach(row => {
            row.removeChild(row.lastElementChild);
        });

        // Reapply features to remaining cells
        applyDynamicFeatures();
    } else {
        alert("No columns left to remove!");
    }
});
applyDynamicFeatures();

// Reset Columns to Default Widths
document.getElementById("reset-columns").addEventListener("click", () => {
    const table = document.querySelector(".resizable-table");
    const columns = table.querySelectorAll("th");

    columns.forEach((column, index) => {
        column.style.width = ""; // Reset to default
        table.querySelectorAll(`td:nth-child(${index + 1})`).forEach(cell => {
            cell.style.width = ""; // Reset cells too
        });
    });

    // Regenerate sliders to reflect reset widths
    generateSliders();
});

// Add a new row to the table
document.getElementById("add-row-button").addEventListener("click", () => {
    const tableBody = document.querySelector(".resizable-table tbody");
    const firstRow = tableBody.querySelector("tr");
    const newRow = document.createElement("tr");


    // Create new cells for the new row
    if (firstRow) {
        const numColumns = firstRow.children.length; // Match the column count
        for (let i = 0; i < numColumns; i++) {
            const newCell = document.createElement("td");
            newCell.contentEditable = true; // Make it editable
            newCell.textContent = "New Value"; // Default content
            newRow.appendChild(newCell);
        }
    }


    tableBody.appendChild(newRow);


    // Reapply popup functionality for all cells
    applyPopupToNewCells();
});


// Remove the last row from the table
document.getElementById("remove-row-button").addEventListener("click", () => {
    const tableBody = document.querySelector(".resizable-table tbody");
    const lastRow = tableBody.querySelector("tr:last-child");


    if (lastRow) {
        tableBody.removeChild(lastRow);


        // Reapply popup functionality for remaining cells
        applyPopupToNewCells();
    } else {
        alert("No rows left to remove!");
    }
});

// Global Variables



// Save Table Functionality


// Global Variables


// Global Variables


// Global Variables
const savedTablesKey = "savedTables"; // LocalStorage key for saved tables
const savedFilesList = document.getElementById("saved-files-list");


// Save Table Functionality with Total Row and Agent Name
function saveTable() {
    const table = document.querySelector(".resizable-table");
    const rows = Array.from(table.rows).map(row => {
        return Array.from(row.cells).map(cell => ({
            content: cell.textContent,
            styles: {
                fontSize: cell.style.fontSize || "",
                fontStyle: cell.style.fontStyle || "",
                width: cell.style.width || "",
            }
        }));
    });


    // Capture Total row values
    const totalRow = {
        totalDebit: document.getElementById("total-debit").value || "0.00",
        totalCredit: document.getElementById("total-credit").value || "0.00",
        totalBalance: document.getElementById("total-balance").value || "0.00"
    };


    // Capture Agent Name
    const agentName = document.getElementById("agent-selector").textContent;


    // Prompt user for save name
    const saveName = prompt("Enter a name for this save:", `Save ${new Date().toLocaleString()}`);
    if (!saveName) {
        alert("Save canceled.");
        return;
    }


    // Save to Firebase
    firebase.database().ref('tables/' + saveName).set({
        name: saveName,
        rows: rows,
        totalRow: totalRow,
        agentName: agentName,
        timestamp: new Date().toLocaleString()
    }).then(() => {
        alert("Table saved successfully!");
        loadSavedTables();
    }).catch(error => {
        console.error("Error saving table:", error);
    });
}



// Load Saved Tables into the Saved Files Tab
function loadSavedTables() {
    firebase.database().ref('tables/').once('value').then(snapshot => {
        const savedTables = snapshot.val();
        const savedFilesList = document.getElementById("saved-files-list");
        savedFilesList.innerHTML = "";


        if (!savedTables) {
            savedFilesList.innerHTML = "<p>No saved files found.</p>";
            return;
        }


        Object.keys(savedTables).forEach(key => {
            const item = savedTables[key];
            const fileEntry = document.createElement("div");
            fileEntry.className = "saved-file-entry";
            fileEntry.innerHTML = `
                <span><strong>${item.name}</strong> (Saved on: ${item.timestamp})</span>
                <div>
                    <button class="load-button" onclick="loadTable('${key}')">Load</button>
                    <button class="delete-button" onclick="deleteTable('${key}')">Delete</button>
                </div>
            `;
            savedFilesList.appendChild(fileEntry);
        });
    }).catch(error => {
        console.error("Error loading saved tables:", error);
    });
}


// Load a Specific Table by Index, Including Total Row and Agent Name
function loadTable(key) {
    firebase.database().ref('tables/' + key).once('value').then(snapshot => {
        const data = snapshot.val();
        if (!data) {
            alert("Failed to load table.");
            return;
        }


        const { rows, totalRow, agentName } = data;
        const table = document.querySelector(".resizable-table tbody");
        table.innerHTML = ""; // Clear existing table rows


        rows.forEach(rowData => {
            const row = document.createElement("tr");
            rowData.forEach(cellData => {
                const cell = document.createElement("td");
                cell.textContent = cellData.content;
                Object.assign(cell.style, cellData.styles);
                row.appendChild(cell);
            });
            table.appendChild(row);
        });


        // Restore Total row values
        document.getElementById("total-debit").value = totalRow.totalDebit;
        document.getElementById("total-credit").value = totalRow.totalCredit;
        document.getElementById("total-balance").value = totalRow.totalBalance;


        // Update Agent Name
        document.getElementById("agent-selector").textContent = agentName;


        alert("Table loaded successfully!");
    }).catch(error => {
        console.error("Error loading table:", error);
    });
}


   

// Delete a Saved Table
function deleteTable(key) {
    firebase.database().ref('tables/' + key).remove().then(() => {
        alert("Saved table deleted.");
        loadSavedTables();
    }).catch(error => {
        console.error("Error deleting table:", error);
    });
}

// Reinitialize All Features After Loading
function reinitializeFeatures() {
    // Reapply Add/Remove Row and Column functionality
    document.getElementById("add-row-button").onclick = addRow;
    document.getElementById("remove-row-button").onclick = removeRow;


    // Reapply Calculate Totals functionality
    document.getElementById("calculate-total").onclick = calculateTotals;


    // Reapply Popup Editor functionality
    applyPopupToNewCells();


    // Reapply column resizing functionality
    generateSliders();
}


// Add Row Functionality
function addRow() {
    const tableBody = document.querySelector(".resizable-table tbody");
    const firstRow = tableBody.querySelector("tr");
    const newRow = document.createElement("tr");


    // Create new cells for the new row
    if (firstRow) {
        const numColumns = firstRow.children.length; // Match the column count
        for (let i = 0; i < numColumns; i++) {
            const newCell = document.createElement("td");
            newCell.contentEditable = true; // Make it editable
            newCell.textContent = ""; // Default content
            newRow.appendChild(newCell);
        }
    }


    tableBody.appendChild(newRow);


    // Reapply popup functionality for all cells
    applyPopupToNewCells();
}


// Remove Row Functionality
function removeRow() {
    const tableBody = document.querySelector(".resizable-table tbody");
    const lastRow = tableBody.querySelector("tr:last-child");


    if (lastRow) {
        tableBody.removeChild(lastRow);


        // Reapply popup functionality for remaining cells
        applyPopupToNewCells();
    } else {
        alert("No rows left to remove!");
    }
}


// Calculate Totals Functionality
function calculateTotals() {
    const rows = document.querySelectorAll(".resizable-table tbody tr");
    let totalDebit = 0;
    let totalCredit = 0;


    // Loop through each row in the table
    rows.forEach(row => {
        const debitCell = row.children[1]; // 2nd child (مدين)
        const creditCell = row.children[2]; // 3rd child (دائن)
        const additionalCell = row.children[3]; // 4th child (نقل)
        const balanceCell = row.children[6]; // Final child (الرصيد)


        // Get numeric values from the cells
        const debitValue = parseFloat(debitCell.textContent) || 0;
        const creditValue = parseFloat(creditCell.textContent) || 0;
        const additionalValue = parseFloat(additionalCell.textContent) || 0;


        // Calculate balance
        const totalCreditAndAdditional = creditValue + additionalValue;
        const balance = debitValue - totalCreditAndAdditional;
        balanceCell.textContent = balance.toFixed(2);


        // Update totals
        totalDebit += debitValue;
        totalCredit += totalCreditAndAdditional;
    });


    // Update totals in the Total Section
    document.getElementById("total-debit").value = totalDebit.toFixed(2);
    document.getElementById("total-credit").value = totalCredit.toFixed(2);
    document.getElementById("total-balance").value = (totalDebit - totalCredit).toFixed(2);
}


// Initialize Saved Files List on Page Load
document.getElementById("save-table-button").addEventListener("click", saveTable);
window.onload = loadSavedTables;



// Initialize Add/Remove Row Buttons
document.getElementById("add-row-button").onclick = addRow;
document.getElementById("remove-row-button").onclick = removeRow;


// Initialize Calculate Button
document.getElementById("calculate-total").onclick = calculateTotals;



// Show/Hide Popup
const showSavedFilesButton = document.getElementById("show-saved-files");
const savedFilesPopup = document.getElementById("saved-files-popup");
const closeSavedFilesButton = document.getElementById("close-saved-files");


showSavedFilesButton.addEventListener("click", () => {
    savedFilesPopup.style.display = "block";
});


closeSavedFilesButton.addEventListener("click", () => {
    savedFilesPopup.style.display = "none";
});


savedFilesPopup.addEventListener("click", (e) => {
    if (e.target === savedFilesPopup) {
        savedFilesPopup.style.display = "none";
    }
});


// Load Saved Tables into the Popup
function loadSavedTables() {
    const savedTables = JSON.parse(localStorage.getItem(savedTablesKey)) || [];
    const savedFilesList = document.getElementById("saved-files-list");
    savedFilesList.innerHTML = "";


    if (savedTables.length === 0) {
        savedFilesList.innerHTML = "<p>No saved files found.</p>";
        return;
    }


    savedTables.forEach((item, index) => {
        const fileEntry = document.createElement("div");
        fileEntry.className = "saved-file-entry";
        fileEntry.innerHTML = `
            <span><strong>${item.name}</strong> (Saved on: ${item.timestamp})</span>
            <div>
                <button class="load-button" onclick="loadTable(${index})">Load</button>
                <button class="delete-button" onclick="deleteTable(${index})">Delete</button>
            </div>
        `;
        savedFilesList.appendChild(fileEntry);
    });
}


// Reinitialize Save Button and Load Tables on Page Load
window.onload = () => {
    loadSavedTables();
};




        // Calculate totals and update the "الرصيد" column
 


        document.getElementById("calculate-total").addEventListener("click", () => {
    const rows = document.querySelectorAll(".resizable-table tbody tr");
    let totalDebit = 0;
    let totalCredit = 0;


    // Loop through each row in the table
    rows.forEach(row => {
        const debitCell = row.children[1]; // 2nd child (مدين)
        const creditCell = row.children[2]; // 3rd child (دائن)
        const additionalCell = row.children[3]; // 4th child (new addition)
        const balanceCell = row.children[6]; // Final child (الرصيد)


        // Get numeric values from the cells
        const debitValue = parseFloat(debitCell.textContent) || 0;
        const creditValue = parseFloat(creditCell.textContent) || 0;
        const additionalValue = parseFloat(additionalCell.textContent) || 0;


        // Add 3rd and 4th child values, subtract from 2nd child, and update the final cell
        const totalCreditAndAdditional = creditValue + additionalValue;
        const balance = debitValue - totalCreditAndAdditional;
        balanceCell.textContent = balance.toFixed(2);


        // Update totals
        totalDebit += debitValue;
        totalCredit += totalCreditAndAdditional;
    });


    // Update totals in the Total Section
    document.getElementById("total-debit").value = totalDebit.toFixed(2);
    document.getElementById("total-credit").value = totalCredit.toFixed(2);
    document.getElementById("total-balance").value = (totalDebit - totalCredit).toFixed(2);
});


        // Reset totals
        //document.getElementById("reset-total").addEventListener("click", () => {
           // document.getElementById("total-debit").value = "0.00";
          //  document.getElementById("total-credit").value = "0.00";
           // document.getElementById("total-balance").value = "0.00";
     //   });

        
        
    </script>
    

<!-- Saved Files Tab -->

</body>
</html>
