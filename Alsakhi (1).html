<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Company Name</title>
    <style>
        body {
            font-family: Tahoma, sans-serif;
            direction: rtl;
            margin: 0;
            padding: 0;
        }

        .saved-files-tab {
    margin: 20px auto;
    padding: 10px;
    border: 2px solid #73a4ff;
    border-radius: 10px;
    background-color: #f9f9f9;
    text-align: center;
    width: 95%;
}




table {
    border-collapse: separate;
    border-spacing: 0 5px; /* Adds vertical spacing between rows */
}
tr.draggable {
    cursor: move;
    background-color: #f9f9f9; /* Default row background */
}

tr.draggable.dragging {
    opacity: 0.5;
    background-color: #ffeb3b; /* Highlight during drag */
    
}

/* Row Dragging Style */
.draggable.dragging {
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3), 0 0 30px rgba(0, 150, 255, 0.8);
    z-index: 1000; /* Ensure it stays above other elements */
}


/* Highlight Drop Target */
.draggable.over {
    background-color: #ffeb3b; /* Highlight drop target */
    transition: background-color 0.3s ease;
}


.saved-file-entry {
    margin: 10px 0;
    padding: 10px;
    border-bottom: 1px solid #ccc;
}


.saved-file-entry button {
    margin: 5px;
    padding: 5px 10px;
    background-color: #73a4ff;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}

.resizable-table tbody tr:nth-child(even) {
    background-color: #dadada;
}
.resizable-table tbody tr:nth-child(odd) {
    background-color: #ffffff;
}

.resizable-table tbody tr:hover {
    background-color: #e3f2fd; /* Light blue */
    transition: background-color 0.3s ease;
}


.saved-file-entry button:hover {
    background-color: #315f80;
}




        header, footer {
            background-color: #ffffff;
            color: #73a4ff;
            text-align: left;
            padding: 8px 0;
            margin-left: 5%;
            position: relative;
        }

        header {
            font-size: 10px;
            font-weight: bold;
        }


        header h2 {
            text-align: right;
            margin-right: 20px;
            font-size: 20px;
            font-weight: bold;
            
        }

        footer {
            position: relative;
            text-align: center;
            font-size: 18px;
            min-height: 100%;
            min-width: 100%;
        }

        .separator-line {
            border: none;
            border-top: 3px solid #73a4ff;
            margin: 5px auto;
            width: 95%;
        }
        
                .agent-row {
            border: none;
            border-top: 3px solid #73a4ff;
            margin: 5px auto;
            width: 95%;
        }

        .footer-line-sep {
            border: none;
            border-top: 5px solid #73a4ff;
            margin: 10px auto;
            width: 95%;
        }

        .resizable-table {
            width: 95%;
            border-collapse: collapse;
            border: 1px solid #000;
            margin: 20px auto;
            table-layout: fixed;
        }

        

        th, td {
            text-align: right;
            border: 1px solid #6d6d6d;
            word-wrap: break-word;
            font-family: Arial, Helvetica, sans-serif;
            white-space: normal;
            overflow: hidden;
            padding: 10px;
            position: relative;
            font-size: 14px;
            cursor: pointer;
        }

        th {
            background-color: #f0f0f0;
            font-weight: bold;
        }

        tr:nth-child(even) {
            background-color: #dadada;
        }

        .highlighted {
            background-color: yellow !important;
        }

        .editor-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #f9f9f9;
            border: 2px solid #73a4ff;
            border-radius: 10px;
            padding: 20px;
            z-index: 1000;
            display: none;
            width: 400px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .editor-popup label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            color: #333;
        }

        .editor-popup input[type="text"], .editor-popup select {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
        }

        .editor-popup input[type="range"] {
            width: 100%;
            margin-bottom: 10px;
        }

        .font-size-display {
            text-align: center;
            margin-top: 5px;
            font-size: 14px;
            font-weight: bold;
            color: #555;
        }

        .editor-popup button {
            margin-top: 10px;
            padding: 10px;
            border: none;
            background-color: #73a4ff;
            color: white;
            cursor: pointer;
            border-radius: 5px;
            width: 48%;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .editor-popup button:hover {
            background-color: #315f80;
        }

        .editor-popup .reset-button {
            background-color: #e63946;
        }

        .editor-popup .reset-button:hover {
            background-color: #a0212f;
        }

        #calculate-button, #calculate-total {
            background-color: #73a4ff;
            color: white;
            font-size: 16px;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 20px auto;
            display: block;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease-in-out;
        }

        #calculate-button:hover, #calculate-total:hover {
            background-color: #315f80;
            transform: scale(1.05);
            box-shadow: 3px 3px 8px rgba(0, 0, 0, 0.5);
        }

        #calculate-button:active, #calculate-total:active {
            transform: scale(1);
            box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
        }
        @media print { 
           #calculate-total {
            display: none;
           }
        }

        .total-section {
            width: 60%;
            margin: 20px auto;
            border: 2px solid #73a4ff;
            border-radius: 10px;
            text-align: center;
            background-color: #f9f9f9;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .total-header {
            font-size: 20px;
            font-weight: bold;
            background-color: #73a4ff;
            color: white;
            padding: 10px;
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
        }
        
        @media print {
    .total-header {
        background-color: #73a4ff !important;
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
        color: white;
    }
}

        .total-body {
            display: flex;
            justify-content: space-around;
            padding: 20px;
        }

        .total-column input {
            background-color: #f1f1f1;
            width: 90%;
            padding: 10px;
            margin-top: 2%;
            text-align: center;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
        }
        #resizing-tool {
    background-color: #f9f9f9;
    border: 2px solid #73a4ff;
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    max-width: 600px;
    text-align: center;
}

#resizing-tool h3 {
    color: #73a4ff;
    margin-bottom: 20px;
}

.slider-container {
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    justify-content: space-between;
}


        @media print { 
           #add-row-button {
            display: none;
           }
        }

        @media print { 
           #remove-row-button {
            display: none;
           }
        }

/* Footer Section */


.slider-container label {
    width: 20%;
    text-align: left;
    font-weight: bold;
}

.slider-container input[type="range"] {
    width: 60%;
}

.slider-value {
    width: 20%;
    text-align: right;
}

#reset-columns {
    background-color: #73a4ff;
    color: white;
    font-size: 14px;
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3);
    transition: all 0.3s ease-in-out;
}

#reset-columns:hover {
    background-color: #73a4ff;
    transform: scale(1.05);
    box-shadow: 3px 3px 8px rgba(0, 0, 0, 0.5);
}

/* Hide Resizing Tool During Print */
@media print {
    #resize-columns-button{
        display: none !important;
    }
}

.resizable-table th:first-child,
.resizable-table td:first-child {
    width: 50px; /* Adjust as needed */
    max-width: 70px; /* Optional: to ensure no extreme resizing */
    text-align: center; /* Optional: for better alignment */
}

@media print {
    #add-column-button,
    #remove-column-button {
        display: none;
    }
}

/* Parent container for centering */
.center-container {
    display: flex; /* Enables flexbox for centering */
    justify-content: center; /* Centers horizontally */
    margin: 10px 0; /* Adds spacing between header and table */
}

/* Oval styling */
.editable-oval {
    display: inline-block; /* Keep it dynamically sized */
    text-align: center;
    font-weight: bold;/* Centers text inside the oval */
    padding: 10px 20px; /* Inner spacing for oval shape */
    border: 2px solid #73a4ff; /* Border color */
    border-radius: 50px; /* Creates the oval shape */
    font-size: 16px; /* Text size */
    color: #000; /* Text color */
    background-color: transparent; /* Transparent background */
    outline: none; /* Removes focus outline */
    cursor: text; /* Shows text-editing cursor */
}


/* Popup Container - Modern Design */
.popup-container {
    display: none; /* Initially hidden */
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.7); /* Dim background with a soft black overlay */
    z-index: 9999; /* On top of everything */
    backdrop-filter: blur(5px); /* Adds a subtle blur effect to the background */
}

/* Popup Content */
/* Popup Content (Scrollable Area) */
.popup-content {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: white;
    padding: 20px;
    border-radius: 10px;
    text-align: center;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    width: 400px;
    max-height: 80vh; /* Limit the popup height to 80% of the viewport */
    overflow-y: auto; /* Enable vertical scrolling if content overflows */
    box-sizing: border-box; /* Ensure padding is included in the dimensions */
}
.popup-content::-webkit-scrollbar {
    width: 8px;
}

.popup-content::-webkit-scrollbar-thumb {
    background-color: #73a4ff;
    border-radius: 4px;
}

.popup-content::-webkit-scrollbar-track {
    background-color: #f1f1f1;
}

/* Popup Title */
.popup-content h3 {
    font-size: 24px; /* Larger font size for the title */
    font-weight: bold;
    color: #333333; /* Dark gray text */
    margin-bottom: 20px; /* Space below the title */
    border-bottom: 2px solid #73a4ff; /* Blue underline */
    padding-bottom: 10px;
}

/* Buttons Container */
.popup-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 15px; /* Spacing between buttons */
    justify-content: center;
    margin-bottom: 20px;
}

/* Agent Buttons */
.agent-button {
    background-color: #73a4ff; /* Primary blue color */
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 8px; /* Smooth rounded corners */
    cursor: pointer;
    font-size: 14px; /* Medium font size */
    font-weight: bold;
    transition: all 0.3s ease; /* Smooth hover effect */
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2); /* Subtle shadow */
}

.agent-button:hover {
    background-color: #315f80; /* Darker blue on hover */
    transform: translateY(-3px); /* Lifts the button */
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3); /* Enhanced shadow on hover */
}

/* Close Button */
#close-popup {
    background-color: #e63946; /* Red for the close button */
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 8px; /* Rounded corners */
    cursor: pointer;
    font-size: 14px; /* Medium font size */
    font-weight: bold;
    transition: all 0.3s ease; /* Smooth hover effect */
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2); /* Subtle shadow */
}

#close-popup:hover {
    background-color: #a0212f; /* Darker red on hover */
    transform: translateY(-3px); /* Lifts the button */
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3); /* Enhanced shadow on hover */
}

/* Saved Files Entry */
.saved-file-entry {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 20px;
    border-radius: 10px; /* Rounded corners */
    background-color: #f9f9f9; /* Light gray background */
    box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1); /* Subtle shadow */
    margin-bottom: 15px; /* Spacing between entries */
    font-size: 14px; /* Medium font size */
    font-weight: bold;
}

/* Load Button */
.saved-file-entry .load-button {
    background-color: #73a4ff; /* Primary blue */
    color: white;
    border: none;
    padding: 8px 15px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 12px; /* Slightly smaller font */
    font-weight: bold;
    transition: all 0.3s ease;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2); /* Subtle shadow */
}

.saved-file-entry .load-button:hover {
    background-color: #315f80;
    transform: scale(1.05); /* Slightly enlarges */
}

/* Delete Button */
.saved-file-entry .delete-button {
    background-color: #e63946; /* Red color */
    color: white;
    border: none;
    padding: 8px 15px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 12px;
    font-weight: bold;
    transition: all 0.3s ease;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2); /* Subtle shadow */
}

.saved-file-entry .delete-button:hover {
    background-color: #a0212f; /* Darker red on hover */
    transform: scale(1.05); /* Slightly enlarges */
}

/* Responsiveness */
@media (max-width: 600px) {
    .popup-content {
        width: 90%;
        padding: 20px;
    }

    .popup-content h3 {
        font-size: 20px;
    }

    .agent-button, #close-popup {
        font-size: 12px;
        padding: 8px 15px;
    }
}

.resizable-table thead th {
    position: sticky;
    top: 0;
    z-index: 2;
    background-color: #73a4ff; /* Blue header */
    color: white;
    border-bottom: 2px solid #ddd;
}

.resizable-table th {
    text-align: center;
    font-size: 16px;
    font-weight: bold;
}


#close-popup:hover {
    background-color: #a0212f;
}

/* Tabs Container */
.tabs-container {
    display: flex;
    align-items: center;
    margin: 20px auto;
    padding: 5px;
    width: 95%;
    border-bottom: 2px solid #73a4ff;
}


.tab-buttons {
    flex-grow: 1;
    display: flex;
    gap: 10px;
    overflow-x: auto;
}


.tab-button {
    padding: 8px 12px;
    border: none;
    border-radius: 5px;
    background-color: #73a4ff;
    color: white;
    cursor: pointer;
    transition: background-color 0.3s ease;
}


.tab-button.active {
    background-color: #315f80;
    font-weight: bold;
}


.tab-button:hover {
    background-color: #315f80;
}


.new-tab-button {
    padding: 5px 10px;
    border: none;
    border-radius: 5px;
    background-color: #e63946;
    color: white;
    cursor: pointer;
    font-size: 20px;
    line-height: 20px;
    height: 35px;
}


.new-tab-button:hover {
    background-color: #a0212f;
}


@media print {
    .new-tab-button, .tab-buttons {
        display: none;
    }
}


#table-container {
    margin: 20px auto;
    width: 95%;
}

/* Floating Button */
.floating-button {
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background-color: #73a4ff;
    color: white;
    border: none;
    box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
    font-size: 24px;
    cursor: pointer;
    transition: all 0.3s ease-in-out;
    z-index: 999;
}


.floating-button:hover {
    background-color: #315f80;
    transform: scale(1.1);
}

.export-button {
    bottom: 90px; /* Place it above the saved files button */
}


/* Popup Styles */


.close-button {
    background-color: #e63946;
    color: white;
    border: none;
    padding: 10px 15px;
    border-radius: 5px;
    cursor: pointer;
    margin-top: 10px;
}


.close-button:hover {
    background-color: #a0212f;
}


/* Saved File Entry */
.saved-file-entry {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin: 10px 0;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
    background-color: #f9f9f9;
}


.saved-file-entry button {
    padding: 5px 10px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s ease;
}


.saved-file-entry button.load-button {
    background-color: #73a4ff;
    color: white;
}


.saved-file-entry button.load-button:hover {
    background-color: #315f80;
}


.saved-file-entry button.delete-button {
    background-color: #e63946;
    color: white;
}


.saved-file-entry button.delete-button:hover {
    background-color: #a0212f;
}

@keyframes row-highlight {
    from {
        background-color: #ffffcc;
    }
    to {
        background-color: transparent;
    }
}

.resizable-table tbody tr.added {
    animation: row-highlight 1.5s ease-out;
}

/* Oval Button Design */
#agent-selector {
    display: inline-block;
    padding: 12px 30px; /* Adds spacious padding */
    border: 2px solid #73a4ff; /* Elegant blue border */
    border-radius: 50px; /* Makes it oval-shaped */
    font-size: 16px; /* Clean and modern font size */
    font-weight: bold; /* Bold text for emphasis */
    color: #315f80; /* Elegant dark blue text */
    background: #ffffff; /* White background for a classy look */
    text-align: center; /* Centers the text */
    text-transform: capitalize; /* Capitalizes text */
    box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1); /* Soft shadow for depth */
    cursor: pointer; /* Indicates interactivity */
    transition: all 0.3s ease; /* Smooth transition for hover effects */
}

/* Hover Effect */
#agent-selector:hover {
    background: #f9f9f9; /* Slightly darker white on hover */
    border-color: #315f80; /* Darker border on hover */
    color: #73a4ff; /* Lighter blue text */
    transform: scale(1.05); /* Slight enlargement */
    box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2); /* Enhanced shadow */
}

/* Active State */
#agent-selector:active {
    transform: scale(0.98); /* Slight press-in effect */
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Reduced shadow */
}

/* Focus State for Accessibility */
#agent-selector:focus {
    outline: none; /* Removes default outline */
    box-shadow: 0 0 0 4px rgba(115, 164, 255, 0.5); /* Elegant focus ring */
}


/* Hide During Print */
/* Floating Buttons Container */
.floating-buttons-container {
    position: fixed;
    bottom: 20px; /* Distance from the bottom of the page */
    right: 20px; /* Distance from the right edge of the page */
    display: flex; /* Align buttons horizontally */
    gap: 10px; /* Space between buttons */
    z-index: 9999; /* Ensure buttons are on top of all content */
}

/* Search Bar */
#search-saved-files {
    font-size: 16px;
    color: #333;
    border: 1px solid #ccc;
    border-radius: 5px;
    padding: 10px;
    width: 90%;
    margin: 0 auto 15px;
    display: block;
}

/* Saved Files List with Scroll Bar */
/* Saved Files List with Scrolling */
.saved-files-list {
    max-height: 300px; /* Limits the height of the list */
    overflow-y: auto; /* Enables vertical scrolling */
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
    background-color: #f9f9f9;
    width: 100%; /* Ensure it spans the popup width */
    box-sizing: border-box; /* Include padding in width */
}

/* Scrollbar Styles */
.saved-files-list::-webkit-scrollbar {
    width: 8px;
}

.saved-files-list::-webkit-scrollbar-thumb {
    background-color: #73a4ff;
    border-radius: 4px;
}

.saved-files-list::-webkit-scrollbar-track {
    background-color: #f1f1f1;
}


/* Floating Buttons (Applies to Both Buttons) */

.saveer {
    background-color:   #21e61b;
}

.onet-edit {
    background-color: #ffffff;
}

@media print {
    .floating-button,
    .saveer,
    .export-button,
    .highlighted,
    .onet-edit
    .popup-container {
        display: none !important;
    }
}
@media print {
    thead {
        background-color: #73a4ff !important;
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
        color: white;
    }
}

    </style>
</head>
<body>
    <header>
       
        <h1>AL SAKHI GENERAL TRADING CO.LTD</h1>
        <h2>ÿ¥ÿ±ŸÉÿ© ÿßŸÑÿ≥ÿÆŸä ŸÑŸÑÿ™ÿ¨ÿßÿ±ÿ© ÿßŸÑÿπÿßŸÖÿ© ÿßŸÑŸÖÿ≠ÿØŸàÿØÿ© </h2>
    </header>
    <hr class="separator-line">
    <div class="center-container">
        <div class="editable-oval" id="agent-selector">Select Agent</div>
    </div>
    
    <!-- Save Files Button -->
<button id="show-saved-files" class="floating-button" title="Saved Files">
    üíæ
</button>
<button id="export-html-button" class="floating-button export-button" title="Export Tables">
    üì§
</button>
<button id="highlighter-button" class="floating-button" title="Highlighter" style="bottom: 160px;">
    ‚úèÔ∏è
</button>




<!-- Saved Files Popup -->
<div id="saved-files-popup" class="popup-container">
    <div class="popup-content">
        <h3>Saved Files</h3>
            <!-- Search Bar -->
            <input type="text" id="search-saved-files" placeholder="Search saved files..." style="width: 90%; padding: 10px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 5px;">

        <div id="saved-files-list"></div>
        <button id="close-saved-files" class="close-button">Close</button>
    </div>
</div>

    
    <!-- Popup -->
    <div id="agent-popup" class="popup-container">
        <div class="popup-content">
            <h3>Select an Agent</h3>
            <div class="popup-buttons">
                <!-- 13 Buttons for Agents -->
                <button class="agent-button" data-agent="ÿÆÿ®Ÿäÿ® - ÿØŸáŸàŸÉ">ÿÆÿ®Ÿäÿ® - ÿØŸáŸàŸÉ</button>
                <button class="agent-button" data-agent="ŸÜ⁄òŸäÿßÿ± - ÿ≤ÿßÿÆŸà">ŸÜ⁄òŸäÿßÿ± - ÿ≤ÿßÿÆŸà</button>
                <button class="agent-button" data-agent="ŸäŸàÿ≥ŸÅ - ÿπŸÇÿ±ÿ©">ŸäŸàÿ≥ŸÅ - ÿπŸÇÿ±ÿ©</button>
                <button class="agent-button" data-agent="ŸÜÿßÿµÿ≠ - ÿ£ÿ±ÿ®ŸäŸÑ">ŸÜÿßÿµÿ≠ - ÿ£ÿ±ÿ®ŸäŸÑ</button>
                <button class="agent-button" data-agent="ÿπŸÑŸä - ÿ£ÿ±ÿ®ŸäŸÑ">ÿπŸÑŸä - ÿ£ÿ±ÿ®ŸäŸÑ</button>
                <button class="agent-button" data-agent="ÿ≥ÿ±ÿØÿßÿ± - ÿ£ÿ±ÿ®ŸäŸÑ">ÿ≥ÿ±ÿØÿßÿ± - ÿ£ÿ±ÿ®ŸäŸÑ</button>
                <button class="agent-button" data-agent="ÿ±Ÿäÿ®Ÿàÿßÿ± - ÿ£ÿ±ÿ®ŸäŸÑ">ÿ±Ÿäÿ®Ÿàÿßÿ± - ÿ£ÿ±ÿ®ŸäŸÑ</button>
                <button class="agent-button" data-agent="ŸÖÿ§ŸäÿØ - ŸÉÿ±ŸÉŸàŸÉ">ŸÖÿ§ŸäÿØ - ŸÉÿ±ŸÉŸàŸÉ</button>
                <button class="agent-button" data-agent="ŸÜŸàÿ±ÿ≥ - ÿ±ÿßŸÜŸäÿ©">ŸÜŸàÿ±ÿ≥ - ÿ±ÿßŸÜŸäÿ©</button>
              <button class="agent-button" data-agent="ŸÅÿ±ŸäÿßÿØ - ŸÉŸÑÿßÿ±" >ŸÅÿ±ŸäÿßÿØ - ŸÉŸÑÿßÿ±</button>
              <button class="agent-button" data-agent="ÿ¥ÿßŸáŸà - ÿ≥ŸÑŸäŸÖÿßŸÜŸäÿ©" >ÿ¥ÿßŸáŸà - ÿ≥ŸÑŸäŸÖÿßŸÜŸäÿ©</button>
              <button class="agent-button" data-agent="ÿ≥ÿ±ÿ®ÿ≥ÿ™ - ŸÉŸÑŸÉ" >ÿ≥ÿ±ÿ®ÿ≥ÿ™ - ŸÉŸÑŸÉ</button>
              <button class="agent-button" data-agent="ÿÆÿ∑ÿßÿ® - ŸÖŸàÿµŸÑ" >ÿÆÿ∑ÿßÿ® - ŸÖŸàÿµŸÑ</button>
              <button class="agent-button" data-agent="ŸÅÿßÿ±ÿ≥ - ÿ±ŸàŸÅŸäÿß" >ŸÅÿßÿ±ÿ≥ - ÿ±ŸàŸÅŸäÿß</button>
            </div>
            <button id="close-popup">Close</button>
        </div>
    </div>
    
    <!-- Main Table -->
    <table class="resizable-table">
        <thead>
            <tr class="draggable">
                <th>#</th>
                <th>ŸÖÿØŸäŸÜ</th>
                <th>ÿØÿßÿ¶ŸÜ</th>
                <th>ŸÜŸÇŸÑ</th>
                <th>ÿßŸÑÿ™ÿßÿ±ŸäÿÆ</th>
                <th>ÿßŸÑÿ®ŸäÿßŸÜ</th>
                <th>ÿßŸÑÿ±ÿµŸäÿØ</th>
            </tr>
        </thead>
        <tbody>
            <tr class="draggable">
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr class="draggable">
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr class="draggable">
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr class="draggable">
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr class="draggable">
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr class="draggable">
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr class="draggable">
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr class="draggable">
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr class="draggable">
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr class="draggable">
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
        </tbody>
    </table>

    <!-- Total Row Section -->
     <!-- Resize Columns Button -->
<button id="resize-columns-button" style="margin: 20px auto; display: block;">Resize Columns</button>

<!-- Add and Remove Columns Buttons -->
<div style="display: flex; justify-content: center; gap: 10px; margin-top: 10px;">
    <button id="add-column-button">Add Column</button>
    <button id="remove-column-button">Remove Column</button>
    <button id="add-row-button">Add Row</button>
<button id="remove-row-button">Remove Row</button>
<button id="save-table-button" class="saveer">Save Table</button>
<button id="toggle-edit-mode" class="onet-edit">One Edit</button>



</div>


<!-- Resizing Tool Section -->
<div id="resizing-tool" style="display: none; margin: 20px auto; text-align: center;">
    <h3>Resize Columns</h3>
    <div id="sliders-container"></div>
    <button id="reset-columns">Reset Columns</button>
</div>

    <div class="total-section">
        <div class="total-header">ÿ≠ÿ≥ÿßÿ® ÿßŸÑŸÉŸÑŸä (ÿØŸäŸÜÿßÿ± ÿπÿ±ÿßŸÇŸä)</div>
        <div class="total-body">
            <div class="total-column">
                <label for="total-debit">ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÖÿØŸäŸÜ:</label>
                <input type="text" id="total-debit" placeholder="0.00" readonly>
            </div>
            <div class="total-column">
                <label for="total-credit">ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿØÿßÿ¶ŸÜ:</label>
                <input type="text" id="total-credit" placeholder="0.00" readonly>
            </div>
            <div class="total-column">
                <label for="total-balance">ÿßŸÑÿ±ÿµŸäÿØ ÿßŸÑŸÜŸáÿßÿ¶Ÿä:</label>
                <input type="text" id="total-balance" placeholder="0.00" readonly>
            </div>
        </div>
        <button id="calculate-total">ÿ≠ÿ≥ÿßÿ®</button>
    </div>


    <!-- Popup Editor -->
    <div class="editor-popup">
        <label for="cell-text">Edit Text:</label>
        <input type="text" id="cell-text" placeholder="Type your text here">

        <label for="font-style">Font Style:</label>
        <select id="font-style">
            <option value="normal">Normal</option>
            <option value="italic">Italic</option>
            <option value="bold">Bold</option>
        </select>

        <label for="font-slider">Font Size:</label>
        <input type="range" id="font-slider" min="10" max="30" value="14">
        <div class="font-size-display" id="font-size-display">14px</div>

        <div id="live-preview">Live Preview: <span id="preview-text"></span></div>

        <div style="display: flex; justify-content: space-between;">
            <button id="save-edit">Save</button>
            <button id="cancel-edit">Cancel</button>
            <button id="reset-edit" class="reset-button">Reset</button>
        </div>
    </div>
    
       
    
    <script>
        let activeElement;
        let originalText = "";
        let originalFontSize = "";
        let originalFontStyle = "";
// Double-click to open the popup
document.querySelectorAll("td, th").forEach(cell => {
    cell.addEventListener("dblclick", () => {
        activeElement = cell;
        document.querySelector(".editor-popup").style.display = "block";

        // Store original values
        originalText = cell.textContent;
        originalFontSize = parseInt(window.getComputedStyle(cell).fontSize, 10); // Ensure numeric font size
        originalFontStyle = window.getComputedStyle(cell).fontStyle;

        // Populate popup fields
        document.getElementById("cell-text").value = originalText;
        document.getElementById("font-slider").value = originalFontSize;
        document.getElementById("font-style").value = originalFontStyle;
        document.getElementById("font-size-display").textContent = `${originalFontSize}px`;

        // Populate preview
        updateLivePreview();
    });
});

// Update preview text dynamically and synchronize slider
document.getElementById("cell-text").addEventListener("input", updateLivePreview);
document.getElementById("font-slider").addEventListener("input", (e) => {
    const fontSize = e.target.value;
    document.getElementById("font-size-display").textContent = `${fontSize}px`;

    // Apply the font size to the active element in real-time
    if (activeElement) {
        activeElement.style.fontSize = `${fontSize}px`;
    }
});
document.getElementById("font-style").addEventListener("change", updateLivePreview);

// Synchronize font size display on popup close or save
function updateLivePreview() {
    const preview = document.getElementById("preview-text");
    const fontSize = document.getElementById("font-slider").value;
    preview.textContent = document.getElementById("cell-text").value;
    preview.style.fontSize = `${fontSize}px`;
    preview.style.fontStyle = document.getElementById("font-style").value;

    // Update slider value display dynamically
    document.getElementById("font-size-display").textContent = `${fontSize}px`;
}

// Save changes
document.getElementById("save-edit").addEventListener("click", () => {
    const newText = document.getElementById("cell-text").value;
    const newFontSize = document.getElementById("font-slider").value + "px";
    const newFontStyle = document.getElementById("font-style").value;

    // Apply changes to the active element
    if (activeElement) {
        activeElement.textContent = newText;
        activeElement.style.fontSize = newFontSize;
        activeElement.style.fontStyle = newFontStyle;
    }

    closePopup();
});

// Cancel editing
document.getElementById("cancel-edit").addEventListener("click", closePopup);

// Reset changes
document.getElementById("reset-edit").addEventListener("click", () => {
    document.getElementById("cell-text").value = originalText;
    document.getElementById("font-slider").value = originalFontSize;
    document.getElementById("font-style").value = originalFontStyle;
    document.getElementById("font-size-display").textContent = `${originalFontSize}px`;
    updateLivePreview();
});

function closePopup() {
    document.querySelector(".editor-popup").style.display = "none";
}

        // Cancel editing
        document.getElementById("cancel-edit").addEventListener("click", closePopup);

        // Reset changes
        document.getElementById("reset-edit").addEventListener("click", () => {
            document.getElementById("cell-text").value = originalText;
            document.getElementById("font-slider").value = originalFontSize;
            document.getElementById("font-style").value = originalFontStyle;
            document.getElementById("font-size-display").textContent = originalFontSize + "px";
            updateLivePreview();
        });

                function closePopup() {
            document.querySelector(".editor-popup").style.display = "none";
        }

        // Handle Resize Columns Button
document.getElementById("resize-columns-button").addEventListener("click", () => {
    const resizingTool = document.getElementById("resizing-tool");
    if (resizingTool.style.display === "none") {
        generateSliders();
        resizingTool.style.display = "block";
    } else {
        resizingTool.style.display = "none";
    }
});

function applyPopupToNewCells() {
    // Reapply the double-click event listener to all table cells
    document.querySelectorAll("td, th").forEach(cell => {
        cell.removeEventListener("dblclick", handleCellDoubleClick); // Avoid duplicate listeners
        cell.addEventListener("dblclick", handleCellDoubleClick);
    });
}


    
// Generate Sliders for Each Column
// Generate Sliders for Each Column
function generateSliders() {
    const table = document.querySelector(".resizable-table");
    const slidersContainer = document.getElementById("sliders-container");
    slidersContainer.innerHTML = ""; // Clear previous sliders

    const columns = table.querySelectorAll("th");
    columns.forEach((column, index) => {
        // Create slider container
        const sliderContainer = document.createElement("div");
        sliderContainer.className = "slider-container";

        // Column label
        const label = document.createElement("label");
        label.textContent = `Column ${index + 1}`;

        // Slider
        const slider = document.createElement("input");
        slider.type = "range";
        slider.min = index === 0 ? "15" : "50"; // Smaller minimum for the first column
        slider.max = index === 0 ? "200" : "500"; // Smaller maximum for the first column
        slider.value = column.offsetWidth; // Set current width as default

        // Slider value display
        const valueDisplay = document.createElement("span");
        valueDisplay.className = "slider-value";
        valueDisplay.textContent = `${column.offsetWidth}px`;

        // Update column width on slider input
        slider.addEventListener("input", () => {
            column.style.width = `${slider.value}px`;
            table.querySelectorAll(`td:nth-child(${index + 1})`).forEach(cell => {
                cell.style.width = `${slider.value}px`;
            });
            valueDisplay.textContent = `${slider.value}px`;
        });

        // Append elements to slider container
        sliderContainer.appendChild(label);
        sliderContainer.appendChild(slider);
        sliderContainer.appendChild(valueDisplay);

        // Append slider container to sliders container
        slidersContainer.appendChild(sliderContainer);
    });
}

function handleCellDoubleClick() {
    activeElement = this; // Reference the clicked element
    document.querySelector(".editor-popup").style.display = "block";

    // Store original values
    originalText = this.textContent;
    originalFontSize = parseInt(window.getComputedStyle(this).fontSize, 10); // Ensure numeric font size
    originalFontStyle = window.getComputedStyle(this).fontStyle;

    // Populate popup fields
    document.getElementById("cell-text").value = originalText;
    document.getElementById("font-slider").value = originalFontSize;
    document.getElementById("font-style").value = originalFontStyle;
    document.getElementById("font-size-display").textContent = `${originalFontSize}px`;

    updateLivePreview();
}


function applyDynamicFeatures() {
    document.querySelectorAll("td, th").forEach(cell => {
        cell.removeEventListener("dblclick", handleCellDoubleClick); // Avoid duplicates
        cell.addEventListener("dblclick", handleCellDoubleClick); // Reapply popup listener
    });
}

// Get references to elements
const agentSelector = document.getElementById("agent-selector");
const popupContainer = document.getElementById("agent-popup");
const closePopupButton = document.getElementById("close-popup");
const agentButtons = document.querySelectorAll(".agent-button");


// Show the popup when clicking the oval text
agentSelector.addEventListener("click", () => {
    popupContainer.style.display = "block";
});


// Close the popup when clicking the "Close" button
closePopupButton.addEventListener("click", () => {
    popupContainer.style.display = "none";
});


// Close the popup when clicking outside of the popup content
popupContainer.addEventListener("click", (e) => {
    if (e.target === popupContainer) {
        popupContainer.style.display = "none";
    }
});


// Update the oval text and close popup when an agent is selected
agentButtons.forEach(button => {
    button.addEventListener("click", () => {
        const selectedAgent = button.getAttribute("data-agent");
        agentSelector.textContent = selectedAgent; // Update the oval text
        popupContainer.style.display = "none"; // Hide the popup
    });
});


// Add a new column to the table
document.getElementById("add-column-button").addEventListener("click", () => {
    const table = document.querySelector(".resizable-table");
    const rows = table.querySelectorAll("tr");

    // Add a new header for the column
    if (rows[0]) {
        const headerCell = document.createElement("th");
        headerCell.textContent = `New Column ${rows[0].children.length + 1}`;
        rows[0].appendChild(headerCell);
    }

    // Add new cells to each row
    rows.forEach((row, rowIndex) => {
        if (rowIndex === 0) return; // Skip header row
        const newCell = document.createElement("td");
        newCell.contentEditable = true; // Make it editable
        newCell.textContent = ""; // Default content
        row.appendChild(newCell);
    });

    // Reapply popup functionality for all cells
    applyPopupToNewCells();
});

// Remove the last column from the table
document.getElementById("remove-column-button").addEventListener("click", () => {
    const table = document.querySelector(".resizable-table");
    const rows = table.querySelectorAll("tr");

    if (rows[0] && rows[0].children.length > 1) {
        rows.forEach(row => {
            row.removeChild(row.lastElementChild);
        });

        // Reapply features to remaining cells
        applyDynamicFeatures();
    } else {
        alert("No columns left to remove!");
    }
});
applyDynamicFeatures();

// Reset Columns to Default Widths
document.getElementById("reset-columns").addEventListener("click", () => {
    const table = document.querySelector(".resizable-table");
    const columns = table.querySelectorAll("th");

    columns.forEach((column, index) => {
        column.style.width = ""; // Reset to default
        table.querySelectorAll(`td:nth-child(${index + 1})`).forEach(cell => {
            cell.style.width = ""; // Reset cells too
        });
    });

    // Regenerate sliders to reflect reset widths
    generateSliders();
});

// Add a new row to the table
document.getElementById("add-row-button").addEventListener("click", () => {
    
})
 

// Remove the last row from the table
document.getElementById("remove-row-button").addEventListener("click", () => {

});

// Global Variables



// Save Table Functionality


// Global Variables


// Global Variables


// Global Variables
const savedTablesKey = "savedTables"; // LocalStorage key for saved tables
const savedFilesList = document.getElementById("saved-files-list");


// Save Table Functionality with Total Row and Agent Name
function saveTable() {
    const table = document.querySelector(".resizable-table");
    const headers = Array.from(table.querySelectorAll("thead th")).map((th) => th.textContent); // Save headers
    const rows = Array.from(table.querySelectorAll("tbody tr")).map((row) => {
        return Array.from(row.cells).map((cell) => ({
            content: cell.textContent,
            styles: {
                fontSize: cell.style.fontSize || "",
                fontStyle: cell.style.fontStyle || "",
                width: cell.style.width || "",
            },
        }));
    });

    // Capture Total row values
    const totalRow = {
        totalDebit: document.getElementById("total-debit").value || "0.00",
        totalCredit: document.getElementById("total-credit").value || "0.00",
        totalBalance: document.getElementById("total-balance").value || "0.00",
    };

    // Capture Agent Name
    const agentName = document.getElementById("agent-selector").textContent;

    // Prompt user for save name
    const saveName = prompt("Enter a name for this save:", ``);
    if (!saveName) {
        alert("Save canceled.");
        return;
    }

    const savedTables = JSON.parse(localStorage.getItem("savedTables")) || [];
    savedTables.push({ name: saveName, headers, rows, totalRow, agentName, timestamp: new Date().toLocaleString() });
    localStorage.setItem("savedTables", JSON.stringify(savedTables));

    alert("Table saved successfully!");
    loadSavedTables(); // Update the saved files list
}

// Load Saved Tables into the Saved Files Tab
// Add Search Bar Filtering for Saved Files
// Search Bar Filtering for Saved Files
document.getElementById("search-saved-files").addEventListener("input", function () {
    const query = this.value.toLowerCase(); // Get search query
    const savedFiles = document.querySelectorAll(".saved-file-entry"); // All saved files

    savedFiles.forEach(file => {
        const fileName = file.querySelector("strong").textContent.toLowerCase(); // Get the file name
        if (fileName.includes(query)) {
            file.style.display = ""; // Show matching files
        } else {
            file.style.display = "none"; // Hide non-matching files
        }
    });
});


// Load Saved Files List (Existing Function)
function loadSavedTables() {
    const savedTables = JSON.parse(localStorage.getItem("savedTables")) || [];
    const savedFilesList = document.getElementById("saved-files-list");
    savedFilesList.innerHTML = ""; // Clear the list

    if (savedTables.length === 0) {
        savedFilesList.innerHTML = "<p>No saved files found.</p>";
        return;
    }

    savedTables.forEach((item, index) => {
        const fileEntry = document.createElement("div");
        fileEntry.className = "saved-file-entry";
        fileEntry.style.marginBottom = "10px"; // Add spacing between entries
        fileEntry.innerHTML = `
            <p><strong>${item.name}</strong> (Saved on: ${item.timestamp})</p>
            <button class="load-button" onclick="loadTable(${index})">Load</button>
            <button class="delete-button" onclick="deleteTable(${index})">Delete</button>
        `;
        savedFilesList.appendChild(fileEntry);
    });
}


// Load a Specific Table by Index, Including Total Row and Agent Name
function loadTable(index) {
    const savedTables = JSON.parse(localStorage.getItem(savedTablesKey)) || [];
    if (!savedTables[index]) {
        alert("Failed to load table.");
        return;
    }

    const { rows, totalRow, agentName } = savedTables[index];
    const table = document.querySelector(".resizable-table");

    // Clear the table body (remove all rows except the header)
    const tableBody = table.querySelector("tbody");
    tableBody.innerHTML = ""; // This ensures only the header remains

    // Recreate the table rows and cells
    rows.forEach(rowData => {
        const row = document.createElement("tr");
        rowData.forEach(cellData => {
            const cell = document.createElement("td");
            cell.textContent = cellData.content;
            Object.assign(cell.style, cellData.styles);
            row.appendChild(cell);
        });
        tableBody.appendChild(row);
    });

    // Restore Total row values
    document.getElementById("total-debit").value = totalRow.totalDebit;
    document.getElementById("total-credit").value = totalRow.totalCredit;
    document.getElementById("total-balance").value = totalRow.totalBalance;

    // Update Agent Name
    document.getElementById("agent-selector").textContent = agentName;

    // Reinitialize features after loading
    reinitializeFeatures();

    alert("Table loaded successfully!");
}


// Delete a Saved Table with Confirmation
function deleteTable(index) {
    const savedTables = JSON.parse(localStorage.getItem(savedTablesKey)) || [];
    const confirmation = confirm("Are you sure you want to delete this saved table?");

    if (confirmation) {
        // If the user clicks "Yes," delete the table
        savedTables.splice(index, 1);
        localStorage.setItem(savedTablesKey, JSON.stringify(savedTables));
        loadSavedTables(); // Refresh the list
        alert("Table deleted successfully!");
    } else {
        // If the user clicks "Cancel," do nothing
       
    }
}


// Reinitialize All Features After Loading
function reinitializeFeatures() {
    // Reapply Add/Remove Row and Column functionality
    document.getElementById("add-row-button").onclick = addRow;
    //document.getElementById("remove-row-button").onclick = removeRow;


    // Reapply Calculate Totals functionality
    document.getElementById("calculate-total").onclick = calculateTotals;


    // Reapply Popup Editor functionality
    applyPopupToNewCells();


    // Reapply column resizing functionality
    generateSliders();
}


// Add Row Functionality
function addRow() {
    const tableBody = document.querySelector(".resizable-table tbody");
    const firstRow = tableBody.querySelector("tr");
    const newRow = document.createElement("tr");
  


    // Create new cells for the new row
    if (firstRow) {
        const numColumns = firstRow.children.length; // Match the column count
        for (let i = 0; i < numColumns; i++) {
            const newCell = document.createElement("td");
            newCell.contentEditable = true; // Make it editable
            newCell.textContent = ""; // Default content
            newRow.appendChild(newCell);
            newCell.textContent = "";
            newCell.contentEditable = true;
            newRow.classList.add("added");
            tableBody.appendChild(newRow);

            setTimeout(() => newRow.classList.remove("added"), 1500);
        }
    }


    tableBody.appendChild(newRow);


    // Reapply popup functionality for all cells
    applyPopupToNewCells();
}


// Remove Row Functionality
function removeRow() {
    const tableBody = document.querySelector(".resizable-table tbody");
    const lastRow = tableBody.querySelector("tr:last-child");


    if (lastRow) {
        tableBody.removeChild(lastRow);


        // Reapply popup functionality for remaining cells
        applyPopupToNewCells();
    } else {
        alert("No rows left to remove!");
    }
}


// Calculate Totals Functionality
function calculateTotals() {
    const rows = document.querySelectorAll(".resizable-table tbody tr");
    let totalDebit = 0;
    let totalCredit = 0;


    // Loop through each row in the table
    rows.forEach(row => {
        const debitCell = row.children[1]; // 2nd child (ŸÖÿØŸäŸÜ)
        const creditCell = row.children[2]; // 3rd child (ÿØÿßÿ¶ŸÜ)
        const additionalCell = row.children[3]; // 4th child (ŸÜŸÇŸÑ)
        const balanceCell = row.children[6]; // Final child (ÿßŸÑÿ±ÿµŸäÿØ)


        // Get numeric values from the cells
        const debitValue = parseFloat(debitCell.textContent) || 0;
        const creditValue = parseFloat(creditCell.textContent) || 0;
        const additionalValue = parseFloat(additionalCell.textContent) || 0;


        // Calculate balance
        const totalCreditAndAdditional = creditValue + additionalValue;
        const balance = debitValue - totalCreditAndAdditional;
        balanceCell.textContent = balance.toFixed(2);


        // Update totals
        totalDebit += debitValue;
        totalCredit += totalCreditAndAdditional;
    });


    // Update totals in the Total Section
    document.getElementById("total-debit").value = totalDebit.toFixed(2);
    document.getElementById("total-credit").value = totalCredit.toFixed(2);
    document.getElementById("total-balance").value = (totalDebit - totalCredit).toFixed(2);
}


// Initialize Saved Files List on Page Load
window.onload = loadSavedTables;


// Add Save Button Event Listener
document.getElementById("save-table-button").addEventListener("click", saveTable);


// Initialize Add/Remove Row Buttons
document.getElementById("add-row-button").onclick = addRow;
document.getElementById("remove-row-button").onclick = removeRow;


// Initialize Calculate Button
document.getElementById("calculate-total").onclick = calculateTotals;



// Show/Hide Popup
const showSavedFilesButton = document.getElementById("show-saved-files");
const savedFilesPopup = document.getElementById("saved-files-popup");
const closeSavedFilesButton = document.getElementById("close-saved-files");


showSavedFilesButton.addEventListener("click", () => {
    savedFilesPopup.style.display = "block";
});


closeSavedFilesButton.addEventListener("click", () => {
    savedFilesPopup.style.display = "none";
});


savedFilesPopup.addEventListener("click", (e) => {
    if (e.target === savedFilesPopup) {
        savedFilesPopup.style.display = "none";
    }
});


// Load Saved Tables into the Popup
function loadSavedTables() {
    const savedTables = JSON.parse(localStorage.getItem(savedTablesKey)) || [];
    const savedFilesList = document.getElementById("saved-files-list");
    savedFilesList.innerHTML = "";


    if (savedTables.length === 0) {
        savedFilesList.innerHTML = "<p>No saved files found.</p>";
        return;
    }


    savedTables.forEach((item, index) => {
        const fileEntry = document.createElement("div");
        fileEntry.className = "saved-file-entry";
        fileEntry.innerHTML = `
            <span><strong>${item.name}</strong> (Saved on: ${item.timestamp})</span>
            <div>
                <button class="load-button" onclick="loadTable(${index})">Load</button>
                <button class="delete-button" onclick="deleteTable(${index})">Delete</button>
            </div>
        `;
        savedFilesList.appendChild(fileEntry);
    });
}


// Reinitialize Save Button and Load Tables on Page Load
window.onload = () => {
    loadSavedTables();
    applyDynamicFeatures();
};

document.getElementById("export-html-button").addEventListener("click", exportAllToPDF);

function exportAllToPDF() {
    const savedTablesKey = "savedTables"; // Key for saved tables in localStorage
    const savedFiles = JSON.parse(localStorage.getItem(savedTablesKey)) || []; // Retrieve saved files

    if (savedFiles.length === 0) {
        alert("No saved files available to export.");
        return;
    }

    // Create a container to combine all saved files
    const combinedContent = document.createElement("div");

    savedFiles.forEach((file, index) => {
        // Create a section for each saved file
        const fileSection = document.createElement("div");
        fileSection.style.pageBreakAfter = "always"; // Ensure each file starts on a new page
        fileSection.style.margin = "20px"; // Add some spacing for better layout

        // Add file name and timestamp
        const fileHeader = document.createElement("h1");
        fileHeader.textContent = `Saved File: ${file.name}`;
        fileHeader.style.textAlign = "center";

        const fileTimestamp = document.createElement("p");
        fileTimestamp.textContent = `Saved on: ${file.timestamp}`;
        fileTimestamp.style.textAlign = "center";

        // Add the table for the saved file
        const table = document.createElement("table");
        table.style.width = "100%";
        table.style.borderCollapse = "collapse";
        table.style.border = "1px solid #000";

        // Add headers
        const thead = document.createElement("thead");
        const headerRow = document.createElement("tr");
        file.headers.forEach(header => {
            const th = document.createElement("th");
            th.textContent = header;
            th.style.border = "1px solid #000";
            th.style.padding = "8px";
            th.style.textAlign = "center";
            headerRow.appendChild(th);
        });
        thead.appendChild(headerRow);
        table.appendChild(thead);

        // Add rows
        const tbody = document.createElement("tbody");
        file.rows.forEach(row => {
            const tr = document.createElement("tr");
            row.forEach(cell => {
                const td = document.createElement("td");
                td.textContent = cell.content;
                td.style.border = "1px solid #000";
                td.style.padding = "8px";
                td.style.textAlign = "center";
                td.style.fontSize = cell.styles.fontSize || "14px";
                td.style.fontStyle = cell.styles.fontStyle || "normal";
                tr.appendChild(td);
            });
            tbody.appendChild(tr);
        });
        table.appendChild(tbody);

        // Add totals if available
        const totals = document.createElement("div");
        if (file.totalRow) {
            totals.innerHTML = `
                <h2>Totals</h2>
                <p>Total Debit: ${file.totalRow.totalDebit}</p>
                <p>Total Credit: ${file.totalRow.totalCredit}</p>
                <p>Total Balance: ${file.totalRow.totalBalance}</p>
            `;
        }

        // Append the content to the file section
        fileSection.appendChild(fileHeader);
        fileSection.appendChild(fileTimestamp);
        fileSection.appendChild(table);
        fileSection.appendChild(totals);

        // Append the section to the combined content
        combinedContent.appendChild(fileSection);
    });

    // Open a new window and write the combined content
    const printWindow = window.open('', '', 'width=800,height=600');
    printWindow.document.write('<html><head><title>Export to PDF</title>');
    document.querySelectorAll('style, link[rel="stylesheet"]').forEach(style => {
        printWindow.document.write(style.outerHTML); // Preserve styles
    });
    printWindow.document.write('</head><body>');
    printWindow.document.write(combinedContent.innerHTML);
    printWindow.document.write('</body></html>');
    printWindow.document.close();

    // Trigger the print dialog
    printWindow.onload = () => {
        printWindow.print();

        // Close the window after printing
        printWindow.onafterprint = () => {
            printWindow.close();
        };
    };
}

// Initialize highlighter toggle state
// Highlighter Tool
let isHighlighterActive = false; // Tracks whether the highlighter tool is active


// Highlighter Button Click Event
document.getElementById("highlighter-button").addEventListener("click", () => {
    isHighlighterActive = !isHighlighterActive; // Toggle the state
    document.body.style.cursor = isHighlighterActive ? "pointer" : "default";


    if (isHighlighterActive) {
        alert("Highlighter tool activated. Click any cell to highlight or unhighlight.");
    } else {
        alert("Highlighter tool deactivated.");
    }
});


// Apply Highlighting Logic to Cells
document.addEventListener("click", (e) => {
    // If the highlighter tool is not active, do nothing
    if (!isHighlighterActive) return;


    // Only toggle highlight on table cells
    if (e.target.tagName === "TD" || e.target.tagName === "TH") {
        e.target.classList.toggle("highlighted");
    }
});


// One-Edit Mode
let editMode = false; // Tracks whether single-click editing is enabled


// One-Edit Mode Toggle Button
document.getElementById("toggle-edit-mode").addEventListener("click", () => {
    editMode = !editMode; // Toggle the mode


    if (editMode) {
        alert("One-edit mode activated. Click a cell to edit.");
    } else {
        alert("One-edit mode deactivated.");
    }


    // Update behavior for all table cells dynamically
    document.querySelectorAll(".resizable-table td").forEach((cell) => {
        cell.removeEventListener("click", handleSingleClick); // Remove previous listeners
        cell.removeEventListener("dblclick", handleDoubleClick); // Remove previous listeners


        if (editMode) {
            cell.addEventListener("click", handleSingleClick); // Add single-click editing
        } else {
            cell.addEventListener("dblclick", handleDoubleClick); // Add double-click popup
        }
    });
});


// Single-Click Editing Handler
function handleSingleClick(e) {
    // Skip editing if the highlighter tool is active
    if (isHighlighterActive) return;


    const cell = e.target;


    // Make the cell editable
    if (!cell.isContentEditable) {
        cell.contentEditable = true;
        cell.focus();
    }


    // Turn off editing when the cell loses focus
    cell.addEventListener(
        "blur",
        () => {
            cell.contentEditable = false;
        },
        { once: true }
    );
}


// Double-Click Editing Handler (Popup)
function handleDoubleClick(e) {
    // Skip double-click editing if editMode or highlighter is active
    if (editMode || isHighlighterActive) return;


    const cell = e.target;


    // Example: Open a popup editor (replace with your actual popup logic)
    alert(`Double-clicked to edit: ${cell.textContent}`);
}


let draggedRow = null;


// Initialize Drag-and-Drop
function initializeDragAndDrop() {
    const rows = document.querySelectorAll(".resizable-table tbody tr");
    
    rows.forEach((row) => {
        row.setAttribute("draggable", true);


        // Drag Start
        row.addEventListener("dragstart", () => {
            draggedRow = row;
            row.classList.add("dragging");
        });


        // Drag End
        row.addEventListener("dragend", () => {
            draggedRow = null;
            row.classList.remove("dragging");
        });


        // Drag Over (Highlight Target)
        row.addEventListener("dragover", (e) => {
            e.preventDefault();
            row.classList.add("over");
        });


        // Drag Leave (Remove Highlight)
        row.addEventListener("dragleave", () => {
            row.classList.remove("over");
        });


        // Drop (Reorder Rows)
        row.addEventListener("drop", () => {
            row.classList.remove("over");


            // Reorder rows in the table
            const tableBody = row.parentNode;
            const rows = Array.from(tableBody.children);
            const draggedIndex = rows.indexOf(draggedRow);
            const targetIndex = rows.indexOf(row);


            if (draggedIndex < targetIndex) {
                tableBody.insertBefore(draggedRow, row.nextSibling);
            } else {
                tableBody.insertBefore(draggedRow, row);
            }
        });
    });
}


// Apply Drag-and-Drop on Page Load
initializeDragAndDrop();

/////////////////
document.addEventListener('keydown', (e) => {
    const focused = document.activeElement;
    if (focused.tagName === 'TD') {
        const row = focused.parentElement;
        const cellIndex = Array.from(row.children).indexOf(focused);

        switch (e.key) {
            case 'ArrowLeft':
                row.children[cellIndex + 1]?.focus();
                break;
            case 'ArrowRight':
                row.children[cellIndex - 1]?.focus();
                break;
            case 'ArrowDown':
                row.nextElementSibling?.children[cellIndex]?.focus();
                break;
            case 'ArrowUp':
                row.previousElementSibling?.children[cellIndex]?.focus();
                break;
        }
    }
});

document.querySelectorAll('td').forEach((cell) => {
    cell.tabIndex = 0; // Make cells focusable
});



// Add new rows dynamically and reapply drag-and-drop logic
document.getElementById('add-row-button').addEventListener('click', () => {
    const tableBody = document.querySelector('#draggable-table tbody');
    const newRow = document.createElement('tr');
    newRow.className = 'draggable';
    newRow.innerHTML = `
        <td>${tableBody.children.length + 1}</td>
        <td>New Person</td>
        <td>New Details...</td>
    `;
    tableBody.appendChild(newRow);

    // Reapply drag-and-drop to new rows
    initializeDragAndDrop();
});


       // Calculate Totals Functionality
// Calculate Totals Functionality
function calculateTotals() {
    const rows = document.querySelectorAll(".resizable-table tbody tr");
    let totalDebit = 0;
    let totalCredit = 0;

    // Loop through each row in the table
    rows.forEach(row => {
        const debitCell = row.children[1]; // 2nd child (ŸÖÿØŸäŸÜ)
        const creditCell = row.children[2]; // 3rd child (ÿØÿßÿ¶ŸÜ)
        const additionalCell = row.children[3]; // 4th child (ŸÜŸÇŸÑ)
        const balanceCell = row.children[6]; // Final child (ÿßŸÑÿ±ÿµŸäÿØ)

        // Remove commas and parse numeric values from the cells
        const debitValue = parseFloat(debitCell.textContent.replace(/,/g, "")) || 0;
        const creditValue = parseFloat(creditCell.textContent.replace(/,/g, "")) || 0;
        const additionalValue = parseFloat(additionalCell.textContent.replace(/,/g, "")) || 0;

        // Calculate the balance for the row
        const totalCreditAndAdditional = creditValue + additionalValue;
        const balance = debitValue - totalCreditAndAdditional;

        // Update the balance cell with formatted value
        balanceCell.textContent = balance.toLocaleString("en-US");

        // Add to totals
        totalDebit += debitValue;
        totalCredit += totalCreditAndAdditional;
    });

    // Update totals in the Total Section with formatted numbers
    document.getElementById("total-debit").value = totalDebit.toLocaleString("en-US");
    document.getElementById("total-credit").value = totalCredit.toLocaleString("en-US");
    document.getElementById("total-balance").value = (totalDebit - totalCredit).toLocaleString("en-US");
}


        // Reset totals
        //document.getElementById("reset-total").addEventListener("click", () => {
           // document.getElementById("total-debit").value = "0.00";
          //  document.getElementById("total-credit").value = "0.00";
           // document.getElementById("total-balance").value = "0.00";
     //   });

        
        
    </script>
    

<!-- Saved Files Tab -->

</body>
</html>
